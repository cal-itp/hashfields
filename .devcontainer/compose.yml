version: "3.8"

services:
  dev:
    build:
      context: ..
      dockerfile: .devcontainer/Dockerfile
    command: sleep infinity
    entrypoint: []
    environment:
      - DOTNET_ENVIRONMENT=Development
    image: hashfields:dev
    working_dir: /hashfields
    volumes:
        - ..:/hashfields

  deploy-alpine:
    build:
      context: ..
      dockerfile: .devcontainer/Dockerfile.deploy
      args:
        - runtime=5.0-alpine
        - target=linux-musl-x64
    command: ["./hashfields"]
    environment:
      - DOTNET_ENVIRONMENT=Production
    image: hashfields:deploy-alpine
